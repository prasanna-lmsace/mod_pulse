{"version":3,"sources":["../src/module.js"],"names":["define","init","module","templatevars","document","getElementsByClassName","l","length","addEventListener","EditorInput","getElementById","caret","j","classList","remove","add","clickforword","i","e","preventDefault","insertAtCaret","getAttribute","querySelector","textNodes","getAllTextNodes","forEach","node","span","createElement","after","appendChild","element","Array","from","childNodes","filter","nodeType","textContent","trim","myValue","caretelements","sel","range","n","thiselem","value","window","getSelection","getRangeAt","rangeCount","deleteContents","insertNode","createTextNode","position","modify","selection","createRange","text","focus","selectionStart","startPos","endPos","selectionEnd","substring"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module javascript to place the placeholders.\n * Modified version of IOMAD Email template emailvars.\n *\n * @package   mod_pulse\n * @category  Classes - autoloading\n * @copyright 2021, bdecent gmbh bdecent.de\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([], function() {\n\n    return {\n\n        /**\n         * Setup the classes to editors works with placeholders.\n         */\n        init: function() {\n            var module = this;\n            var templatevars = document.getElementsByClassName(\"fitem_id_templatevars_editor\");\n            for (var l = 0; l < templatevars.length; l++) {\n                templatevars[l].addEventListener('click', function() {\n                    var EditorInput = document.getElementById('id_pulse_content_editoreditable');\n                    var caret = document.getElementsByClassName(\"insertatcaretactive\");\n                    for (var j = 0; j < caret.length; j++) {\n                        caret[j].classList.remove(\"insertatcaretactive\");\n                    }\n                    EditorInput.classList.add(\"insertatcaretactive\");\n\n                });\n            }\n            var clickforword = document.getElementsByClassName('clickforword');\n            for (var i = 0; i < clickforword.length; i++) {\n                clickforword[i].addEventListener('click', function(e) {\n                    e.preventDefault(); // To prevent the default behaviour of a tag.\n                    module.insertAtCaret(\"{\" + this.getAttribute('data-text') + \"}\");\n                });\n            }\n\n            // Make selected roles as badges in module edit form page.\n            if (document.getElementById('page-mod-pulse-mod') !== null && document.getElementById('page-mod-pulse-mod')\n                .querySelector(\"#fgroup_id_completionrequireapproval [data-fieldtype='autocomplete']\") !== null) {\n                const textNodes = this.getAllTextNodes(\n                    document.getElementById('page-mod-pulse-mod')\n                    .querySelector(\"#fgroup_id_completionrequireapproval [data-fieldtype='autocomplete']\")\n                );\n                textNodes.forEach(node => {\n                    const span = document.createElement('span');\n                    span.classList = 'badge badge-info pulse-completion-roles';\n                    node.after(span);\n                    span.appendChild(node);\n                });\n            }\n        },\n\n        /**\n         * Filter text from node.\n         * @param  {string} element\n         * @returns {array} list of childNodes.\n         */\n        getAllTextNodes: function(element) {\n            return Array.from(element.childNodes)\n            .filter(node => node.nodeType === 3 && node.textContent.trim().length > 1);\n        },\n\n        /**\n         * Insert the placeholder in selected caret place.\n         * @param  {string} myValue\n         */\n        insertAtCaret: function(myValue) {\n            var caretelements = document.getElementsByClassName(\"insertatcaretactive\");\n            var sel, range;\n            for (var n = 0; n < caretelements.length; n++) {\n                var thiselem = caretelements[n];\n\n                if (typeof thiselem.value === 'undefined' && window.getSelection) {\n                    sel = window.getSelection();\n                    if (sel.getRangeAt && sel.rangeCount) {\n                        range = sel.getRangeAt(0);\n                        range.deleteContents();\n                        range.insertNode(document.createTextNode(myValue));\n\n                        for (let position = 0; position != (myValue.length + 1); position++) {\n                            sel.modify(\"move\", \"right\", \"character\");\n                        }\n                    }\n                } else if (typeof thiselem.value === 'undefined' && document.selection && document.selection.createRange) {\n                    range = document.selection.createRange();\n                    range.text = myValue;\n                }\n\n                if (typeof thiselem.value !== 'undefined') {\n                    if (document.selection) {\n                        // For browsers like Internet Explorer.\n                        thiselem.focus();\n                        sel = document.selection.createRange();\n                        sel.text = myValue;\n                        thiselem.focus();\n                    } else if (thiselem.selectionStart || thiselem.selectionStart == '0') {\n                        // For browsers like Firefox and Webkit based.\n                        var startPos = thiselem.selectionStart;\n                        var endPos = thiselem.selectionEnd;\n                        thiselem.value = thiselem.value.substring(0, startPos)\n                            + myValue + thiselem.value.substring(endPos, thiselem.value.length);\n                        thiselem.focus();\n                        thiselem.selectionStart = startPos + myValue.length;\n                        thiselem.selectionEnd = startPos + myValue.length;\n                        thiselem.focus();\n                    } else {\n                        thiselem.value += myValue;\n                        thiselem.focus();\n                    }\n                }\n            }\n        },\n    };\n});\n"],"file":"module.min.js"}