{"version":3,"sources":["../src/preset.js"],"names":["define","$","Modal","ModalPreset","PresetEvents","Str","Fragment","AJAX","Templates","Loadingicon","Notification","Preset","contextId","courseid","pageparams","setupmodal","prototype","loadIconElement","actionbuttons","THIS","triggerelement","document","querySelectorAll","forEach","element","addEventListener","presetid","getAttribute","params","create","type","TYPE","body","loadFragment","large","then","modal","show","getRoot","on","customize","modform","forms","modformdata","FormData","get","form","formdata","URLSearchParams","toString","addIconToContainer","disableButtons","applyCustomize","save","e","preventDefault","restorePreset","catch","exception","contextID","done","html","js","handleFormSubmissionResponse","destroy","buttons","$i","disabled","data","newform","createElement","innerHTML","replaceNode","contextid","formdatastr","promises","call","methodname","args","response","JSON","parse","url","window","location","href","init"],"mappings":"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","sourcesContent":["define(['jquery', 'core/modal_factory', 'mod_pulse/modal_preset', 'mod_pulse/events', 'core/str',\n'core/fragment', 'core/ajax', 'core/templates', 'core/loadingicon', 'core/notification'],\n    function($, Modal, ModalPreset, PresetEvents, Str, Fragment, AJAX, Templates, Loadingicon, Notification) {\n\n\n    var Preset = function(contextId, courseid, pageparams) {\n        this.contextId = contextId;\n        this.courseid = courseid;\n        this.pageparams = pageparams;\n\n        this.setupmodal();\n    };\n\n    Preset.prototype.contextId = 0;\n\n    Preset.prototype.courseid = 0;\n\n    Preset.prototype.pageparams = [];\n\n    Preset.prototype.loadIconElement = '.modal-footer #loader-icon';\n\n    Preset.prototype.actionbuttons = '.modal-footer button';\n\n    Preset.prototype.setupmodal = function() {\n\n        var THIS = this;\n\n        var triggerelement = document.querySelectorAll('.pulse-usepreset');\n        triggerelement.forEach((element) => element.addEventListener('click', () => {\n            var presetid = element.getAttribute('data-presetid');\n            var params = {'presetid': presetid, 'courseid': THIS.courseid};\n            Modal.create({\n                type: ModalPreset.TYPE,\n                body: Fragment.loadFragment('mod_pulse', 'get_preset_preview', THIS.contextId, params),\n                large: true\n            }).then(modal => {\n                modal.show();\n                modal.getRoot().on(PresetEvents.customize, () => {\n                    var modform = document.forms[0];\n                    var modformdata = new FormData(modform);\n                    modal.getRoot().get(0).querySelectorAll('form').forEach(form => {\n                        var formdata = new FormData(form);\n                        formdata = new URLSearchParams(formdata).toString();\n                        var pageparams = new URLSearchParams(modformdata).toString();\n                        params = {formdata: formdata, pageparams: pageparams};\n\n                        Loadingicon.addIconToContainer(this.loadIconElement);\n                        THIS.disableButtons();\n                        THIS.applyCustomize(params, THIS.contextId, modal);\n                    });\n                });\n\n                modal.getRoot().on(PresetEvents.save, (e) => {\n                    e.preventDefault();\n                    Loadingicon.addIconToContainer(this.loadIconElement);\n                    THIS.disableButtons();\n                    var formdata = {};\n                    modal.getRoot().get(0).querySelectorAll('form').forEach(form => {\n                        formdata = new FormData(form);\n                        this.restorePreset(formdata, THIS.contextId);\n                    });\n                });\n                return true;\n            }).catch(Notification.exception);\n        }));\n\n    };\n\n    Preset.prototype.applyCustomize = function(params, contextID, modal) {\n        Fragment.loadFragment('mod_pulse', 'apply_preset', contextID, params).done((html, js) => {\n            this.handleFormSubmissionResponse(html, js);\n            modal.destroy();\n        });\n    };\n\n    Preset.prototype.disableButtons = function() {\n        var buttons = document.querySelectorAll(this.actionbuttons);\n        for (let $i in buttons) {\n            buttons[$i].disabled = true;\n        }\n    };\n\n    Preset.prototype.handleFormSubmissionResponse = (data, js) => {\n        var newform = document.createElement('div');\n        newform.innerHTML = data;\n        Templates.replaceNode('[action=\"modedit.php\"]', data, js);\n    };\n\n    Preset.prototype.restorePreset = (formdata, contextid) => {\n        var formdatastr = new URLSearchParams(formdata).toString();\n        var promises = AJAX.call([{\n            methodname: 'mod_pulse_apply_presets',\n            args: {contextid: contextid, formdata: formdatastr}\n        }]);\n\n        promises[0].done((response) => {\n            response = JSON.parse(response);\n            if (typeof response.url != 'undefined') {\n                window.location.href = response.url;\n            }\n        });\n    };\n\n\n    return {\n        init: (contextId, courseid) => {\n            new Preset(contextId, courseid);\n        }\n    };\n});\n"],"file":"preset.min.js"}