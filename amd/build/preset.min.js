define ("mod_pulse/preset",["jquery","core/modal_factory","mod_pulse/modal_preset","mod_pulse/events","core/str","core/fragment","core/ajax","core/templates","core/loadingicon","core/notification"],function(a,b,c,d,e,f,g,h,i,j){var k=function(a,b,c){this.contextId=a;this.courseid=b;this.pageparams=c;this.setupmodal()};k.prototype.contextId=0;k.prototype.courseid=0;k.prototype.pageparams=[];k.prototype.loadIconElement=".modal-footer #loader-icon";k.prototype.actionbuttons=".modal-footer button";k.prototype.setupmodal=function(){var a=this,g=this,h=document.querySelectorAll(".pulse-usepreset");h.forEach(function(e){return e.addEventListener("click",function(){var h=e.getAttribute("data-presetid"),k={presetid:h,courseid:g.courseid};b.create({type:c.TYPE,body:f.loadFragment("mod_pulse","get_preset_preview",g.contextId,k),large:!0}).then(function(b){b.show();b.getRoot().on(d.customize,function(){var c=document.forms[0],d=new FormData(c);b.getRoot().get(0).querySelectorAll("form").forEach(function(c){var e=new FormData(c);e=new URLSearchParams(e).toString();var f=new URLSearchParams(d).toString();k={formdata:e,pageparams:f};i.addIconToContainer(a.loadIconElement);g.disableButtons();g.applyCustomize(k,g.contextId,b)})});b.getRoot().on(d.save,function(c){c.preventDefault();i.addIconToContainer(a.loadIconElement);g.disableButtons();var d={};b.getRoot().get(0).querySelectorAll("form").forEach(function(b){d=new FormData(b);a.restorePreset(d,g.contextId)})});return!0}).catch(j.exception)})})};k.prototype.applyCustomize=function(a,b,c){var d=this;f.loadFragment("mod_pulse","apply_preset",b,a).done(function(a,b){d.handleFormSubmissionResponse(a,b);c.destroy()})};k.prototype.disableButtons=function(){var a=document.querySelectorAll(this.actionbuttons);for(var b in a){a[b].disabled=!0}};k.prototype.handleFormSubmissionResponse=function(a,b){var c=document.createElement("div");c.innerHTML=a;h.replaceNode("[action=\"modedit.php\"]",a,b)};k.prototype.restorePreset=function(a,b){var c=new URLSearchParams(a).toString(),d=g.call([{methodname:"mod_pulse_apply_presets",args:{contextid:b,formdata:c}}]);d[0].done(function(a){a=JSON.parse(a);if("undefined"!=typeof a.url){window.location.href=a.url}})};return{init:function init(a,b){new k(a,b)}}});
//# sourceMappingURL=preset.min.js.map
