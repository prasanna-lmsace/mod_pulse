define ("mod_pulse/preset",["jquery","core/modal_factory","mod_pulse/modal_preset","mod_pulse/events","core/str","core/fragment","core/ajax","core/templates","core/loadingicon","core/notification","core/modal_events"],function(a,b,c,d,e,f,g,h,i,j,k){var l=function(a,b,c){this.contextId=a;this.courseid=b;this.pageparams=c;this.loadPresetsList()};l.prototype.listElement={selector:"pulse-presets-data",loaded:"data-listloaded"};l.prototype.contextId=0;l.prototype.courseid=0;l.prototype.pageparams=[];l.prototype.loadIconElement=".modal-footer #loader-icon";l.prototype.actionbuttons=".modal-footer button";l.prototype.setupmodal=function(){var a=this,g=this,h=document.querySelectorAll(".pulse-usepreset");h.forEach(function(h){return h.addEventListener("click",function(){var l=h.getAttribute("data-presetid"),m=h.getAttribute("data-presettitle"),n={presetid:l,courseid:g.courseid};b.create({type:c.TYPE,title:e.get_string("presetmodaltitle","pulse",{title:m}),body:f.loadFragment("mod_pulse","get_preset_preview",g.contextId,n),large:!0}).then(function(b){b.show();b.getRoot().on(k.hidden,b.destroy.bind(b));b.getRoot().on(d.customize,function(){var c=document.forms[0],d=new FormData(c);b.getRoot().get(0).querySelectorAll("form").forEach(function(c){var e=new FormData(c);e=new URLSearchParams(e).toString();var f=new URLSearchParams(d).toString();n={formdata:e,pageparams:f};i.addIconToContainer(a.loadIconElement);g.disableButtons();g.applyCustomize(n,g.contextId,b)})});b.getRoot().on(d.save,function(c){c.preventDefault();i.addIconToContainer(a.loadIconElement);g.disableButtons();var d={};b.getRoot().get(0).querySelectorAll("form").forEach(function(b){d=new FormData(b);a.restorePreset(d,g.contextId)})});return!0}).catch(j.exception)})})};l.prototype.applyCustomize=function(a,b,c){var d=this;f.loadFragment("mod_pulse","apply_preset",b,a).done(function(a,b){d.handleFormSubmissionResponse(a,b);c.destroy()})};l.prototype.disableButtons=function(){var a=document.querySelectorAll(this.actionbuttons);for(var b in a){a[b].disabled=!0}};l.prototype.handleFormSubmissionResponse=function(a,b){var c=document.createElement("div");c.innerHTML=a;h.replaceNode("[action=\"modedit.php\"]",a,b)};l.prototype.restorePreset=function(a,b){var c=new URLSearchParams(a).toString(),d=g.call([{methodname:"mod_pulse_apply_presets",args:{contextid:b,formdata:c}}]);d[0].done(function(a){a=JSON.parse(a);if("undefined"!=typeof a.url){window.location.href=a.url}})};l.prototype.loadPresetsList=function(){var a=this,b=document.getElementById(this.listElement.selector);if(null!==b){if("false"==b.getAttribute(this.listElement.loaded)){f.loadFragment("mod_pulse","get_presetslist",this.contextId,{courseid:this.courseid}).done(function(c,d){h.replaceNodeContents(b,c,d);b.setAttribute(a.listElement.loaded,"true");a.setupmodal()})}}};return{init:function init(a,b){new l(a,b)}}});
//# sourceMappingURL=preset.min.js.map
